generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "darwin-arm64"]
}

datasource db {
  provider = "sqlite"
  url      = "file:./nexus_desktop.db"
}

model User {
  id            Int              @id @default(autoincrement())
  username      String           @unique
  email         String           @unique
  password      String
  firstName     String?
  lastName      String?
  role          String           @default("NEURON")
  department    String           @default("GENERAL")
  region        String?          @default("SW")
  status        String           @default("active")
  envScope      String           @default("PROD")
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  managerId     Int?
  auditLogs     AuditLog[]
  comments      Comment[]
  enterprises   Enterprise[]     @relation("EnterpriseOwner")
  notifications Notification[]
  logs          SystemUsageLog[]
  manager       User?            @relation("UserHierarchy", fields: [managerId], references: [id])
  subordinates  User[]           @relation("UserHierarchy")
  veracityTasks VeracityTask[]

  @@map("users")
}

model Enterprise {
  id                      Int       @id @default(autoincrement())
  enterpriseName          String    @unique
  envScope                String    @default("PROD")
  feijiangWenxin          String?
  latitude                Float?
  longitude               Float?
  region                  String?   @default("SW")
  ownerId                 Int?
  clueStage               String    @default("LEAD")
  clueSource              String?
  clueSourceDetail        String?
  clueInTime              String?
  industry                String?
  city                    String?
  registeredCapital       Float?
  establishDate           String?
  techStack               String?
  partnerLevel            String?
  status                  String?   @default("active")
  priority                String?
  unifiedSocialCreditCode String?
  base                    String?
  employeeCount           Int?
  enterpriseBackground    String?
  taskDirection           String?
  contactInfo             String?
  usageScenario           String?
  clueUpdateTime          DateTime?
  ecoAIProducts           String?
  certExpiryDate          DateTime?
  legalRepresentative     String?
  establishmentDate       DateTime?
  enterpriseType          String?
  officeAddress           String?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
  certStatus              String?   @default("PENDING")
  shippingStatus          String?   @default("NOT_SHIPPED")
  trackingNumber          String?
  owner                   User?     @relation("EnterpriseOwner", fields: [ownerId], references: [id])

  @@map("enterprises")
}

model AuditLog {
  id        Int      @id @default(autoincrement())
  userId    Int
  action    String
  module    String
  details   String?
  oldValue  String?
  newValue  String?
  timestamp DateTime @default(now())
  ipAddress String?
  user      User     @relation(fields: [userId], references: [id])

  @@map("audit_logs")
}

model VeracityTask {
  id         String   @id @default(uuid())
  targetName String
  status     String   @default("PENDING")
  progress   Int      @default(0)
  step       String?
  resultData String?
  envScope   String   @default("PROD")
  userId     Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       User     @relation(fields: [userId], references: [id])

  @@map("veracity_tasks")
}

model Report {
  id            Int       @id @default(autoincrement())
  title         String
  type          String
  format        String
  status        String    @default("pending")
  description   String?
  filters       String?
  configuration String?
  filePath      String?
  fileName      String?
  dataCount     Int       @default(0)
  progress      Int       @default(0)
  password      String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  completedAt   DateTime?
  createdBy     String?
  errorMessage  String?
  envScope      String    @default("PROD")

  @@map("reports")
}

model KnowledgeBase {
  id        Int      @id @default(autoincrement())
  title     String
  content   String
  category  String
  tags      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("knowledge_bases")
}

model SystemConfig {
  id          Int      @id @default(autoincrement())
  key         String   @unique
  value       String
  description String?
  updatedAt   DateTime @updatedAt

  @@map("system_configs")
}

model Policy {
  id            Int      @id @default(autoincrement())
  title         String
  content       String
  type          String
  level         String
  category      String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  publishCity   String?
  publishYear   Int?
  industryTags  String?
  summary       String?
  mindMapString String?
  originalUrl   String?
  processStatus String   @default("PENDING")
  status        String   @default("ACTIVE")
  envScope      String   @default("PROD")

  @@map("policies")
}

model SystemUsageLog {
  id        Int      @id @default(autoincrement())
  endpoint  String
  method    String
  userId    Int?
  timestamp DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [id])

  @@map("system_usage_logs")
}

model Comment {
  id           Int      @id @default(autoincrement())
  content      String
  authorId     Int
  targetType   String
  targetId     Int
  mentionedIds String?
  createdAt    DateTime @default(now())
  author       User     @relation(fields: [authorId], references: [id])

  @@map("comments")
}

model Notification {
  id        Int      @id @default(autoincrement())
  userId    Int
  type      String
  title     String
  content   String
  isRead    Boolean  @default(false)
  link      String?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])

  @@map("notifications")
}
