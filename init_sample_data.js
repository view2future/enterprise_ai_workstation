require('dotenv').config();
const { Pool } = require('pg');

// æ•°æ®åº“è¿æ¥æ± 
const pool = new Pool({
  user: process.env.DB_USER || 'wangyu94',
  host: process.env.DB_HOST || 'localhost',
  database: process.env.DB_NAME || 'enterprise_db',
  password: process.env.DB_PASSWORD || '',
  port: process.env.DB_PORT || 5432,
});

// ç¤ºä¾‹ä¼ä¸šæ•°æ®
const sampleEnterprises = [
  {
    ä¼ä¸šåç§°: 'ç™¾åº¦æ™ºèƒ½äº‘ç§‘æŠ€æœ‰é™å…¬å¸',
    é£æ¡¨æ–‡å¿ƒ: 'æ–‡å¿ƒ',
    çº¿ç´¢å…¥åº“æ—¶é—´: '2025Q1',
    ä¼™ä¼´ç­‰çº§: 'è®¤è¯çº§',
    ç”Ÿæ€AIäº§å“: '2025-01 æ–‡å¿ƒä¸€è¨€ä¼ä¸šç‰ˆ',
    ä¼˜å…ˆçº§: 'P0',
    base: 'åŒ—äº¬',
    æ³¨å†Œèµ„æœ¬: 50000,
    å‚ä¿äººæ•°: 2000,
    ä¼ä¸šèƒŒæ™¯: 'ç™¾åº¦æ——ä¸‹æ™ºèƒ½äº‘ä¸šåŠ¡å…¬å¸ï¼Œä¸“æ³¨äºAIæŠ€æœ¯åœ¨ä¼ä¸šæœåŠ¡é¢†åŸŸçš„åº”ç”¨ï¼Œä¸ç™¾åº¦æ·±åº¦åˆä½œå¼€å‘å¤§æ¨¡å‹åº”ç”¨åœºæ™¯ã€‚å…¬å¸æ‹¥æœ‰å¼ºå¤§çš„æŠ€æœ¯ç ”å‘å›¢é˜Ÿï¼Œè‡´åŠ›äºä¸ºä¼ä¸šæä¾›é«˜è´¨é‡çš„AIè§£å†³æ–¹æ¡ˆã€‚',
    è¡Œä¸š: JSON.stringify(['äººå·¥æ™ºèƒ½', 'äº‘è®¡ç®—', 'å¤§æ•°æ®']),
    ä»»åŠ¡æ–¹å‘: 'å¤§æ¨¡å‹å¼€å‘ã€è‡ªç„¶è¯­è¨€å¤„ç†ã€æ™ºèƒ½å®¢æœ',
    è”ç³»äººä¿¡æ¯: 'ææ˜ï¼ˆCTOï¼‰13800138001',
    ä½¿ç”¨åœºæ™¯: 'ä¼ä¸šçº§å¤§æ¨¡å‹è§£å†³æ–¹æ¡ˆï¼Œä¸ºé‡‘èã€æ•™è‚²ã€æ”¿åŠ¡ç­‰è¡Œä¸šæä¾›AIèƒ½åŠ›æ”¯æŒã€‚'
  },
  {
    ä¼ä¸šåç§°: 'é£æ¡¨æ·±åº¦å­¦ä¹ æŠ€æœ¯æœ‰é™å…¬å¸',
    é£æ¡¨æ–‡å¿ƒ: 'é£æ¡¨',
    çº¿ç´¢å…¥åº“æ—¶é—´: '2025Q1',
    ä¼™ä¼´ç­‰çº§: 'è®¤è¯çº§',
    ç”Ÿæ€AIäº§å“: '2025-02 é£æ¡¨ä¼ä¸šç‰ˆå¹³å°',
    ä¼˜å…ˆçº§: 'P0',
    base: 'æ·±åœ³',
    æ³¨å†Œèµ„æœ¬: 30000,
    å‚ä¿äººæ•°: 1500,
    ä¼ä¸šèƒŒæ™¯: 'ä¸“æ³¨äºæ·±åº¦å­¦ä¹ æ¡†æ¶ç ”å‘çš„é«˜ç§‘æŠ€ä¼ä¸šï¼ŒåŸºäºé£æ¡¨æ·±åº¦å­¦ä¹ å¹³å°å¼€å‘è¡Œä¸šè§£å†³æ–¹æ¡ˆã€‚å…¬å¸åœ¨è®¡ç®—æœºè§†è§‰å’Œè‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸæ‹¥æœ‰æ·±åšæŠ€æœ¯ç§¯ç´¯ï¼ŒæœåŠ¡ä¼—å¤šè¡Œä¸šå®¢æˆ·ã€‚',
    è¡Œä¸š: JSON.stringify(['äººå·¥æ™ºèƒ½', 'æ·±åº¦å­¦ä¹ ', 'è®¡ç®—æœºè§†è§‰']),
    ä»»åŠ¡æ–¹å‘: 'è®¡ç®—æœºè§†è§‰ã€ç›®æ ‡æ£€æµ‹ã€å›¾åƒè¯†åˆ«',
    è”ç³»äººä¿¡æ¯: 'ç‹åï¼ˆæŠ€æœ¯æ€»ç›‘ï¼‰13800138002',
    ä½¿ç”¨åœºæ™¯: 'å·¥ä¸šè´¨æ£€ã€åŒ»ç–—å½±åƒåˆ†æã€è‡ªåŠ¨é©¾é©¶è§†è§‰ç³»ç»Ÿç­‰åœºæ™¯çš„AIæ¨¡å‹å¼€å‘ä¸éƒ¨ç½²ã€‚'
  },
  {
    ä¼ä¸šåç§°: 'æ™ºèƒ½å®¢æœæŠ€æœ¯æœ‰é™å…¬å¸',
    é£æ¡¨æ–‡å¿ƒ: 'é£æ¡¨',
    çº¿ç´¢å…¥åº“æ—¶é—´: '2025Q2',
    ä¼™ä¼´ç­‰çº§: 'ä¼˜é€‰çº§',
    ç”Ÿæ€AIäº§å“: '2025-03 æ™ºèƒ½å¯¹è¯æœºå™¨äºº',
    ä¼˜å…ˆçº§: 'P1',
    base: 'ä¸Šæµ·',
    æ³¨å†Œèµ„æœ¬: 5000,
    å‚ä¿äººæ•°: 200,
    ä¼ä¸šèƒŒæ™¯: 'ä¸“ä¸šæä¾›æ™ºèƒ½å®¢æœè§£å†³æ–¹æ¡ˆçš„å…¬å¸ï¼Œåˆ©ç”¨AIæŠ€æœ¯æå‡å®¢æˆ·æœåŠ¡æ•ˆç‡å’Œè´¨é‡ã€‚å…¬å¸æ‹¥æœ‰è‡ªç ”çš„è‡ªç„¶è¯­è¨€å¤„ç†å¼•æ“ï¼Œåœ¨ç”µå•†å’Œé‡‘èå®¢æœé¢†åŸŸæœ‰ä¸°å¯Œå®æ–½ç»éªŒã€‚',
    è¡Œä¸š: JSON.stringify(['äººå·¥æ™ºèƒ½', 'å®¢æœç³»ç»Ÿ', 'è‡ªç„¶è¯­è¨€å¤„ç†']),
    ä»»åŠ¡æ–¹å‘: 'æ™ºèƒ½é—®ç­”ã€è¯­éŸ³è¯†åˆ«ã€æƒ…æ„Ÿåˆ†æ',
    è”ç³»äººä¿¡æ¯: 'å¼ ä¼Ÿï¼ˆäº§å“æ€»ç›‘ï¼‰13800138003',
    ä½¿ç”¨åœºæ™¯: 'ç”µå•†ã€é‡‘èã€ç”µä¿¡ç­‰è¡Œä¸šæ™ºèƒ½å®¢æœç³»ç»Ÿï¼Œæ”¯æŒå¤šè½®å¯¹è¯å’Œè¯­ä¹‰ç†è§£ã€‚'
  },
  {
    ä¼ä¸šåç§°: 'AIåŒ»ç–—å½±åƒç§‘æŠ€æœ‰é™å…¬å¸',
    é£æ¡¨æ–‡å¿ƒ: 'é£æ¡¨',
    çº¿ç´¢å…¥åº“æ—¶é—´: '2025Q2',
    ä¼™ä¼´ç­‰çº§: 'ä¼˜é€‰çº§',
    ç”Ÿæ€AIäº§å“: '2025-04 åŒ»ç–—å½±åƒåˆ†æå¹³å°',
    ä¼˜å…ˆçº§: 'P1',
    base: 'æ­å·',
    æ³¨å†Œèµ„æœ¬: 8000,
    å‚ä¿äººæ•°: 150,
    ä¼ä¸šèƒŒæ™¯: 'ä¸“æ³¨äºAIåŒ»ç–—å½±åƒåˆ†æçš„åˆ›æ–°ä¼ä¸šï¼Œä¸å¤šå®¶ä¸‰ç”²åŒ»é™¢å»ºç«‹åˆä½œå…³ç³»ã€‚å…¬å¸åœ¨åŒ»å­¦å½±åƒAIé¢†åŸŸæœ‰å¤šå¹´ç ”å‘ç»éªŒï¼Œäº§å“å·²é€šè¿‡å¤šé¡¹åŒ»å­¦è®¤è¯ã€‚',
    è¡Œä¸š: JSON.stringify(['äººå·¥æ™ºèƒ½', 'åŒ»ç–—ç§‘æŠ€', 'è®¡ç®—æœºè§†è§‰']),
    ä»»åŠ¡æ–¹å‘: 'åŒ»å­¦å½±åƒè¯†åˆ«ã€ç—…ç¶æ£€æµ‹ã€è¾…åŠ©è¯Šæ–­',
    è”ç³»äººä¿¡æ¯: 'åˆ˜èŠ³ï¼ˆåŒ»å­¦æ€»ç›‘ï¼‰13800138004',
    ä½¿ç”¨åœºæ™¯: 'CTã€MRIå½±åƒè‡ªåŠ¨åˆ†æï¼Œè¾…åŠ©åŒ»ç”Ÿå¿«é€Ÿå‡†ç¡®è¯Šæ–­ç–¾ç—…ï¼Œæå‡è¯Šç–—æ•ˆç‡ã€‚'
  },
  {
    ä¼ä¸šåç§°: 'æ™ºèƒ½åˆ¶é€ è§£å†³æ–¹æ¡ˆæœ‰é™å…¬å¸',
    é£æ¡¨æ–‡å¿ƒ: 'é£æ¡¨',
    çº¿ç´¢å…¥åº“æ—¶é—´: '2025Q3',
    ä¼™ä¼´ç­‰çº§: 'æ— ',
    ç”Ÿæ€AIäº§å“: '',
    ä¼˜å…ˆçº§: 'P2',
    base: 'å¹¿å·',
    æ³¨å†Œèµ„æœ¬: 3000,
    å‚ä¿äººæ•°: 80,
    ä¼ä¸šèƒŒæ™¯: 'ä¸ºåˆ¶é€ ä¸šæä¾›æ™ºèƒ½åŒ–å‡çº§è§£å†³æ–¹æ¡ˆï¼Œé‡ç‚¹å‘å±•å·¥ä¸šè§†è§‰å’Œé¢„æµ‹æ€§ç»´æŠ¤æŠ€æœ¯ã€‚å…¬å¸è‡´åŠ›äºé€šè¿‡AIæŠ€æœ¯å¸®åŠ©ä¼ ç»Ÿåˆ¶é€ ä¸šå®ç°æ•°å­—åŒ–è½¬å‹ï¼Œæ‹¥æœ‰å¤šä¸ªæˆåŠŸæ¡ˆä¾‹ã€‚',
    è¡Œä¸š: JSON.stringify(['äººå·¥æ™ºèƒ½', 'å·¥ä¸šäº’è”ç½‘', 'æ™ºèƒ½åˆ¶é€ ']),
    ä»»åŠ¡æ–¹å‘: 'å·¥ä¸šè§†è§‰æ£€æµ‹ã€è®¾å¤‡é¢„æµ‹æ€§ç»´æŠ¤ã€ç”Ÿäº§ä¼˜åŒ–',
    è”ç³»äººä¿¡æ¯: 'é™ˆå¼ºï¼ˆè§£å†³æ–¹æ¡ˆæ€»ç›‘ï¼‰13800138005',
    ä½¿ç”¨åœºæ™¯: 'ç”Ÿäº§çº¿è´¨é‡æ£€æµ‹ã€è®¾å¤‡å¥åº·ç›‘æµ‹ã€ç”Ÿäº§æµç¨‹ä¼˜åŒ–ç­‰å·¥ä¸šAIåº”ç”¨åœºæ™¯ã€‚'
  }
];

// ä¸ºä¼ä¸šæ·»åŠ çš„è¿›å±•ç¤ºä¾‹
const sampleProgress = [
  {
    enterprise_name: 'ç™¾åº¦æ™ºèƒ½äº‘ç§‘æŠ€æœ‰é™å…¬å¸',
    progress_type: 'æœ¬å‘¨è¿›å±•',
    content: 'å®Œæˆäº†æ–‡å¿ƒä¸€è¨€ä¼ä¸šç‰ˆAPIæ¥å£çš„ä¼˜åŒ–ï¼Œæå‡äº†å“åº”é€Ÿåº¦30%ï¼Œå¹¶ä¸3å®¶é‡‘èå®¢æˆ·ç­¾è®¢äº†POCåˆåŒã€‚'
  },
  {
    enterprise_name: 'é£æ¡¨æ·±åº¦å­¦ä¹ æŠ€æœ¯æœ‰é™å…¬å¸',
    progress_type: 'æœ¬å‘¨è¿›å±•',
    content: 'å‘å¸ƒäº†é£æ¡¨ä¼ä¸šç‰ˆå¹³å°2.0ç‰ˆæœ¬ï¼Œæ–°å¢äº†æ¨¡å‹å‹ç¼©åŠŸèƒ½ï¼Œå·²ä¸º2å®¶åˆ¶é€ ä¸šå®¢æˆ·æä¾›æŠ€æœ¯åŸ¹è®­ã€‚'
  },
  {
    enterprise_name: 'æ™ºèƒ½å®¢æœæŠ€æœ¯æœ‰é™å…¬å¸',
    progress_type: 'æœ¬å‘¨è¿›å±•',
    content: 'å®Œæˆäº†ç”µå•†å¹³å°æ™ºèƒ½å®¢æœç³»ç»Ÿéƒ¨ç½²ï¼Œæ”¯æŒå¤šè¯­è¨€å®¢æœï¼Œä¸Šçº¿åå®¢æˆ·æ»¡æ„åº¦æå‡è‡³95%ã€‚'
  },
  {
    enterprise_name: 'AIåŒ»ç–—å½±åƒç§‘æŠ€æœ‰é™å…¬å¸',
    progress_type: 'æœ¬å‘¨è¿›å±•',
    content: 'ä¸åå’ŒåŒ»é™¢åˆä½œçš„è‚ºç»“èŠ‚æ£€æµ‹é¡¹ç›®é€šè¿‡ä¸´åºŠéªŒè¯ï¼Œå‡†ç¡®ç‡è¾¾åˆ°92%ï¼Œæ­£åœ¨ç”³è¯·åŒ»ç–—å™¨æ¢°è®¤è¯ã€‚'
  },
  {
    enterprise_name: 'æ™ºèƒ½åˆ¶é€ è§£å†³æ–¹æ¡ˆæœ‰é™å…¬å¸',
    progress_type: 'æœ¬å‘¨è¿›å±•',
    content: 'å®Œæˆäº†æ±½è½¦é›¶éƒ¨ä»¶å‚å•†è§†è§‰æ£€æµ‹ç³»ç»Ÿçš„éœ€æ±‚è°ƒç ”ï¼Œé¢„è®¡ä¸‹æœˆå¼€å§‹åŸå‹å¼€å‘ã€‚'
  }
];

async function insertSampleData() {
  console.log('ğŸ“¦ å¼€å§‹æ’å…¥ç¤ºä¾‹æ•°æ®...');

  try {
    // æ’å…¥ä¼ä¸šæ•°æ®
    console.log('ğŸ“ æ’å…¥ä¼ä¸šæ•°æ®...');
    for (const enterprise of sampleEnterprises) {
      try {
        const result = await pool.query(`
          INSERT INTO enterprises (
            ä¼ä¸šåç§°, é£æ¡¨_æ–‡å¿ƒ, çº¿ç´¢å…¥åº“æ—¶é—´, ä¼™ä¼´ç­‰çº§, ç”Ÿæ€AIäº§å“, ä¼˜å…ˆçº§,
            base, æ³¨å†Œèµ„æœ¬, å‚ä¿äººæ•°, ä¼ä¸šèƒŒæ™¯, è¡Œä¸š, ä»»åŠ¡æ–¹å‘,
            è”ç³»äººä¿¡æ¯, ä½¿ç”¨åœºæ™¯
          ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14)
          ON CONFLICT (ä¼ä¸šåç§°) DO NOTHING
          RETURNING id
        `, [
          enterprise.ä¼ä¸šåç§°,
          enterprise.é£æ¡¨æ–‡å¿ƒ,
          enterprise.çº¿ç´¢å…¥åº“æ—¶é—´,
          enterprise.ä¼™ä¼´ç­‰çº§,
          enterprise.ç”Ÿæ€AIäº§å“,
          enterprise.ä¼˜å…ˆçº§,
          enterprise.base,
          enterprise.æ³¨å†Œèµ„æœ¬,
          enterprise.å‚ä¿äººæ•°,
          enterprise.ä¼ä¸šèƒŒæ™¯,
          enterprise.è¡Œä¸š,
          enterprise.ä»»åŠ¡æ–¹å‘,
          enterprise.è”ç³»äººä¿¡æ¯,
          enterprise.ä½¿ç”¨åœºæ™¯
        ]);
        
        if (result.rows.length > 0) {
          console.log(`âœ… æˆåŠŸæ’å…¥ä¼ä¸š: ${enterprise.ä¼ä¸šåç§°}`);
        } else {
          console.log(`â„¹ï¸  ä¼ä¸šå·²å­˜åœ¨: ${enterprise.ä¼ä¸šåç§°}`);
        }
      } catch (error) {
        console.error(`âŒ æ’å…¥ä¼ä¸š ${enterprise.ä¼ä¸šåç§°} å¤±è´¥:`, error.message);
      }
    }

    // ä¸ºæ¯å®¶ä¼ä¸šæ·»åŠ è¿›å±•
    console.log('\nğŸ’¬ ä¸ºç›¸å…³ä¼ä¸šæ·»åŠ è¿›å±•...');
    for (const progress of sampleProgress) {
      try {
        // è·å–ä¼ä¸šID
        const enterpriseResult = await pool.query(`
          SELECT id FROM enterprises WHERE ä¼ä¸šåç§° = $1
        `, [progress.enterprise_name]);
        
        if (enterpriseResult.rows.length > 0) {
          const result = await pool.query(`
            INSERT INTO enterprise_progress (enterprise_id, content, progress_type)
            VALUES ($1, $2, $3)
            ON CONFLICT DO NOTHING
            RETURNING id
          `, [enterpriseResult.rows[0].id, progress.content, progress.progress_type]);
          
          if (result.rows.length > 0) {
            console.log(`âœ… ä¸º ${progress.enterprise_name} æ·»åŠ è¿›å±•: ${progress.progress_type}`);
          } else {
            console.log(`â„¹ï¸  è¿›å±•å¯èƒ½å·²å­˜åœ¨: ${progress.enterprise_name}`);
          }
        } else {
          console.log(`âš ï¸  æ‰¾ä¸åˆ°ä¼ä¸š: ${progress.enterprise_name}`);
        }
      } catch (error) {
        console.error(`âŒ ä¸º ${progress.enterprise_name} æ·»åŠ è¿›å±•å¤±è´¥:`, error.message);
      }
    }

    // éªŒè¯æ•°æ®
    const countResult = await pool.query('SELECT COUNT(*) as total FROM enterprises');
    console.log(`\nğŸ“Š æ€»å…±åˆ›å»ºäº† ${countResult.rows[0].total} å®¶ä¼ä¸šè®°å½•`);
    
    const progressCountResult = await pool.query('SELECT COUNT(*) as total FROM enterprise_progress');
    console.log(`ğŸ“Š æ€»å…±åˆ›å»ºäº† ${progressCountResult.rows[0].total} æ¡è¿›å±•è®°å½•`);

    console.log('\nğŸ‰ ç¤ºä¾‹æ•°æ®æ’å…¥å®Œæˆï¼');
    console.log('ğŸ  è®¿é—® http://localhost:3000 æŸ¥çœ‹ä¼ä¸šç®¡ç†ç³»ç»Ÿ');
    
  } catch (error) {
    console.error('âŒ æ’å…¥ç¤ºä¾‹æ•°æ®å¤±è´¥:', error.message);
    throw error;
  }
}

insertSampleData()
  .then(() => {
    console.log('\nâœ… ç¤ºä¾‹æ•°æ®åˆå§‹åŒ–æˆåŠŸï¼');
    process.exit(0);
  })
  .catch(error => {
    console.error('\nâŒ ç¤ºä¾‹æ•°æ®åˆå§‹åŒ–å¤±è´¥:', error);
    process.exit(1);
  });